# CLI Interface Contract: Delete Task

**Feature**: Delete Task (004-delete-task)
**Date**: 2025-12-31
**Status**: Complete

## Overview

This document defines the command-line interface contract for the Delete Task feature. It specifies exact input formats, output formats, error messages, and exit codes.

## Command Format

```bash
python -m src.main delete <TASK_ID>
```

### Syntax

**Program**: `python -m src.main`
**Command**: `delete`
**Arguments**: `<TASK_ID>` (required positional argument)
**Flags**: `--help` (optional)

## Input Contract

### Positional Arguments

| Argument | Type | Required | Description | Validation |
|----------|------|----------|-------------|------------|
| `task_id` | string | Yes | Unique task identifier (UUID5 format) | Any non-empty string accepted (lenient) |

**Note**: Task ID validation is lenient at CLI layer - any string is accepted. Existence validation happens in service layer.

### Optional Flags

| Flag | Type | Description |
|------|------|-------------|
| `--help` or `-h` | boolean | Display help text and exit |

## Output Contract

### Success Response

**Exit Code**: 0

**Output** (stdout):
```text
Task deleted successfully!
ID: <task_id>
Title: <title>
Description: <description or "(none)">
Status: <Complete|Incomplete>
```

**Format Rules**:
- First line: Exactly "Task deleted successfully!"
- Following lines: Key-value pairs with format "Key: Value"
- Description shows "(none)" if empty string
- Status capitalized (first letter uppercase)

**Example** (task with description):
```text
Task deleted successfully!
ID: a1b2c3d4-e5f6-7890-abcd-ef1234567890
Title: Buy milk
Description: Get organic whole milk from Trader Joe's
Status: Incomplete
```

**Example** (task without description):
```text
Task deleted successfully!
ID: x9y8z7w6-v5u4-3210-fedc-ba0987654321
Title: Call John
Description: (none)
Status: Complete
```

### Error Response: Task Not Found

**Exit Code**: 1

**Output** (stderr):
```text
Error: Task not found with ID: <task_id>
```

**Format Rules**:
- Exact text: "Error: Task not found with ID: "
- Followed by the task ID provided by user
- Single line to stderr

**Example**:
```text
Error: Task not found with ID: nonexistent-id-123
```

**Triggers**:
- Task ID doesn't exist in storage
- Empty task list (storage is empty)
- Task was previously deleted in current session

### Error Response: Missing Task ID Argument

**Exit Code**: 2

**Output** (stderr):
```text
usage: todo delete [-h] task_id
todo delete: error: the following arguments are required: task_id
```

**Format Rules**:
- Generated by argparse automatically
- Two lines: usage line, then error line
- Standard argparse error format

**Triggers**:
- User runs `delete` with no arguments
- User runs `delete` with only flags (e.g., `delete --help` doesn't trigger this)

## Help Text Contract

**Command**: `python -m src.main delete --help`

**Exit Code**: 0

**Output** (stdout):
```text
usage: todo delete [-h] task_id

Delete an existing task by its unique ID

positional arguments:
  task_id     Unique task identifier (UUID)

options:
  -h, --help  show this help message and exit
```

**Format Rules**:
- Generated by argparse automatically
- Program name shown as "todo delete" (matches spec)
- Description: "Delete an existing task by its unique ID"
- Task ID described as "Unique task identifier (UUID)"

## Exit Codes

| Code | Meaning | Scenario |
|------|---------|----------|
| 0 | Success | Task deleted successfully |
| 1 | Business Logic Error | Task ID not found in storage |
| 2 | Input Validation Error | Missing required task_id argument (argparse error) |

**Rationale**: Follows standard Unix convention and matches existing Add Task/Update Task patterns.

## Implementation Details

### CLI Module Location

**File**: `src/cli/delete_task.py`

**Function**: `delete_task_command(args: list[str] = None) -> None`

### Argument Parser Configuration

```python
parser = argparse.ArgumentParser(
    description="Delete an existing task by its unique ID",
    prog='todo delete'
)

parser.add_argument(
    'task_id',
    type=str,
    help='Unique task identifier (UUID)'
)
```

### Error Handling Pattern

```python
try:
    deleted_task = delete_task(task_id)  # Service layer call

    # Success message
    print("Task deleted successfully!")
    print(f"ID: {deleted_task.id}")
    print(f"Title: {deleted_task.title}")
    print(f"Description: {deleted_task.description if deleted_task.description else '(none)'}")
    print(f"Status: {deleted_task.status.value.capitalize()}")

    sys.exit(0)

except KeyError:
    # Task not found error
    print(f"Error: Task not found with ID: {task_id}", file=sys.stderr)
    sys.exit(1)
```

## Test Scenarios

### Success Scenarios

**Test 1**: Delete existing task with description
```bash
$ python -m src.main delete abc-123-def
Task deleted successfully!
ID: abc-123-def
Title: Buy milk
Description: Get organic milk
Status: Incomplete
```

**Test 2**: Delete existing task without description
```bash
$ python -m src.main delete xyz-789
Task deleted successfully!
ID: xyz-789
Title: Call John
Description: (none)
Status: Complete
```

### Error Scenarios

**Test 3**: Delete non-existent task
```bash
$ python -m src.main delete nonexistent-id
Error: Task not found with ID: nonexistent-id
$ echo $?
1
```

**Test 4**: Delete without task ID
```bash
$ python -m src.main delete
usage: todo delete [-h] task_id
todo delete: error: the following arguments are required: task_id
$ echo $?
2
```

### Help Scenario

**Test 5**: Display help text
```bash
$ python -m src.main delete --help
usage: todo delete [-h] task_id

Delete an existing task by its unique ID

positional arguments:
  task_id     Unique task identifier (UUID)

options:
  -h, --help  show this help message and exit
$ echo $?
0
```

## Unicode Support

**Requirement**: FR-010 - System MUST correctly display Unicode characters in deleted task confirmation message

**Test Scenario**: Delete task with Unicode in title/description
```bash
$ python -m src.main delete unicode-task-id
Task deleted successfully!
ID: unicode-task-id
Title: CafÃ© â˜•
Description: æ—¥æœ¬èªžã®ãƒ†ã‚¹ãƒˆ ðŸŽ‰
Status: Incomplete
```

**Implementation Note**: Python 3.13+ handles UTF-8 natively. No special encoding handling required in CLI layer.

## Integration with Service Layer

### Service Function Contract

```python
def delete_task(task_id: str) -> Task:
    """
    Delete a task from in-memory storage.

    Args:
        task_id: Unique task identifier

    Returns:
        Task: The deleted task object

    Raises:
        KeyError: If task ID not found
    """
```

### Responsibility Separation

**Service Layer Responsibilities**:
- Task existence validation
- Storage mutation (removal from `_tasks`)
- Return deleted Task object
- Raise KeyError if not found

**CLI Layer Responsibilities**:
- Argument parsing (task ID extraction)
- Service function invocation
- Exception handling (translate KeyError to user message)
- Output formatting (success/error messages)
- Exit code management

## Validation Checklist

Before marking CLI interface complete, verify:

- [ ] Task ID accepted as positional argument (not flag)
- [ ] Success message shows all task fields (ID, title, description, status)
- [ ] Description shows "(none)" when empty
- [ ] Status is capitalized (Complete/Incomplete)
- [ ] Error message matches exact format for not found
- [ ] Exit code 0 for success
- [ ] Exit code 1 for task not found
- [ ] Exit code 2 for missing argument
- [ ] Help text displays correctly
- [ ] Unicode characters display correctly
- [ ] Argparse prog name is "todo delete"
- [ ] Description is "Delete an existing task by its unique ID"

## References

- Spec: `specs/004-delete-task/spec.md`
- Plan: `specs/004-delete-task/plan.md`
- Data Model: `specs/004-delete-task/data-model.md`
- Research: `specs/004-delete-task/research.md`
