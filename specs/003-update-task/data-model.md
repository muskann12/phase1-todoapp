# Data Model: Update Task Feature

**Feature**: 003-update-task
**Date**: 2025-12-31
**Status**: Complete

## Overview

Update Task feature does NOT introduce new data entities. It operates on the existing **Task** entity defined in `src/models/task.py` from the Add Task feature (001-add-task).

This document describes the Task entity structure and field mutability rules relevant to the Update Task feature.

---

## Entity: Task

**Source**: `src/models/task.py` (existing)
**Type**: Python dataclass
**Storage**: In-memory dictionary (`_tasks: Dict[str, Task]` in `src/services/task_service.py`)

### Fields

| Field | Type | Constraints | Mutable | Notes |
|-------|------|-------------|---------|-------|
| `id` | `str` | UUID5 format, unique, non-empty | üîí Immutable | Generated by `generate_task_id()`, deterministic based on timestamp + counter |
| `title` | `str` | 1-500 characters (after trim), non-empty | ‚úèÔ∏è Mutable (via Update Task) | Primary task summary, validated in `__post_init__` |
| `description` | `str` | 0-2000 characters, can be empty | ‚úèÔ∏è Mutable (via Update Task) | Optional task details, defaults to "" |
| `status` | `TaskStatus` | Enum: INCOMPLETE or COMPLETE | ‚öôÔ∏è Status-dependent (via Mark Complete feature) | Default: INCOMPLETE, NOT updated by Update Task |
| `created` | `datetime` | Auto-generated on creation | üîí Immutable | Timestamp when task was first created, preserved across updates |

### Field Mutability Matrix

**Mutable Fields (Update Task feature)**:
- ‚úèÔ∏è `title`: Can be updated via `update_task(task_id, title="new value")`
- ‚úèÔ∏è `description`: Can be updated via `update_task(task_id, description="new value")`

**Immutable Fields (preserved across updates)**:
- üîí `id`: NEVER changes (unique identifier for task lifetime)
- üîí `created`: NEVER changes (historical record of task creation time)

**Status-Dependent Fields (other features)**:
- ‚öôÔ∏è `status`: Modified by Mark Complete/Incomplete feature, NOT by Update Task

---

## Validation Rules

Validation is enforced in the Task dataclass `__post_init__` method. Update Task feature reuses this validation by creating a new Task instance with updated fields.

### Title Validation

```python
# Implemented in Task.__post_init__
1. Strip whitespace: title = title.strip()
2. Check non-empty: if not title ‚Üí raise ValueError("Title cannot be empty")
3. Check length: if len(title) > 500 ‚Üí raise ValueError("Title cannot exceed 500 characters")
```

**Update Task specific**:
- If user provides `--title ""` (empty string) ‚Üí validation fails ‚Üí error displayed
- If user omits `--title` flag ‚Üí title unchanged (None passed to update_task)

### Description Validation

```python
# Implemented in Task.__post_init__
1. Check length: if len(description) > 2000 ‚Üí raise ValueError("Description cannot exceed 2000 characters")
2. Allow empty: description = "" is valid
```

**Update Task specific**:
- If user provides `--description ""` ‚Üí clears description to empty string (valid)
- If user omits `--description` flag ‚Üí description unchanged (None passed to update_task)

### ID Validation

- ID format is UUID5 (deterministic, based on namespace + timestamp + counter)
- Uniqueness guaranteed by `generate_task_id()` function
- **Update Task does NOT modify ID** (immutable field)

### Created Timestamp

- Auto-generated via `datetime.now()` on task creation
- **Update Task does NOT modify created timestamp** (immutable field)

### Status

- Enum: `TaskStatus.INCOMPLETE` or `TaskStatus.COMPLETE`
- Default: `TaskStatus.INCOMPLETE` on creation
- **Update Task does NOT modify status** (handled by Mark Complete/Incomplete feature)

---

## Data Operations

### Update Task Operations

**Operation**: `update_task(task_id: str, title: str | None = None, description: str | None = None) -> Task`

**Preconditions**:
1. `task_id` must exist in `_tasks` dictionary (else KeyError)
2. At least one of `title` or `description` must be provided (else ValueError)

**Process**:
1. Retrieve existing task: `task = _tasks[task_id]`
2. Determine new values:
   - `new_title = title if title is not None else task.title`
   - `new_description = description if description is not None else task.description`
3. Create updated task instance (triggers validation):
   ```python
   updated_task = Task(
       id=task.id,              # Preserve (immutable)
       title=new_title,         # New or existing
       description=new_description,  # New or existing
       status=task.status,      # Preserve (not updated here)
       created=task.created     # Preserve (immutable)
   )
   ```
4. Replace in storage: `_tasks[task_id] = updated_task`
5. Return updated task

**Postconditions**:
- Task ID unchanged
- Created timestamp unchanged
- Status unchanged
- Title updated (if provided) or unchanged
- Description updated (if provided) or unchanged
- Validation rules enforced on new values

**Exceptions**:
- `KeyError`: Task not found with given ID
- `ValueError`: Validation failed (empty title, length exceeded, no updates provided)

---

## Storage Model

**Type**: In-memory dictionary
**Location**: `src/services/task_service.py`
**Structure**: `_tasks: Dict[str, Task] = {}`

```python
# Example state after updates
_tasks = {
    "abc-123-uuid-here": Task(
        id="abc-123-uuid-here",
        title="Buy milk",  # Updated from "Buy mlk"
        description="Organic whole milk",  # Updated from ""
        status=TaskStatus.INCOMPLETE,
        created=datetime(2025, 12, 31, 10, 0, 0)
    ),
    "xyz-789-uuid-here": Task(
        id="xyz-789-uuid-here",
        title="Call Sarah",  # Updated from "Call John"
        description="Discuss project timeline",  # Unchanged
        status=TaskStatus.COMPLETE,
        created=datetime(2025, 12, 31, 11, 30, 0)
    ),
}
```

**Key Points**:
- Dictionary key is task ID (string)
- Dictionary value is Task object (dataclass instance)
- Updates replace entire Task object (immutable pattern at dict level)
- No persistence across process restarts (Phase I constraint)

---

## State Transitions

Update Task does NOT change task state (INCOMPLETE ‚Üî COMPLETE). It only modifies mutable fields (title, description).

**Allowed Updates**:
```
INCOMPLETE task with title "A" ‚Üí INCOMPLETE task with title "B" ‚úÖ
COMPLETE task with description "X" ‚Üí COMPLETE task with description "Y" ‚úÖ
INCOMPLETE task ‚Üí INCOMPLETE task (both title and description updated) ‚úÖ
```

**Disallowed Updates** (via Update Task):
```
INCOMPLETE task ‚Üí COMPLETE task ‚ùå (use Mark Complete feature)
Task with ID "abc" ‚Üí Task with ID "xyz" ‚ùå (ID immutable)
Task created 2025-12-31 ‚Üí Task created 2025-01-01 ‚ùå (created immutable)
```

---

## Relationship to Other Features

### Add Task (001-add-task)
- **Defines** Task entity and validation rules
- Update Task **reuses** Task dataclass and validation
- No changes to Task model required for Update Task

### View Task List (002-view-task-list)
- Displays tasks after updates
- Updated task information **immediately reflected** in view output (FR requirement SC-006)
- No special handling needed (same _tasks dict)

### Mark Complete/Incomplete (future feature)
- **Modifies** `status` field (TaskStatus enum)
- Update Task **preserves** status field (does not conflict)
- Both features can operate independently on same task

---

## Data Integrity Rules

1. **ID Uniqueness**: Task IDs must be unique across all tasks (enforced by UUID5 generation)
2. **ID Immutability**: Once assigned, task ID never changes
3. **Created Timestamp Immutability**: Once set, created timestamp never changes
4. **Title Required**: Title must always be non-empty (1-500 chars after trim)
5. **Description Optional**: Description can be empty string (0-2000 chars)
6. **Status Preservation**: Update Task must not modify status field
7. **Validation Consistency**: Same validation rules apply to create and update operations

---

## Summary

**No new entities introduced.** Update Task feature operates entirely on the existing Task entity with these characteristics:

- **2 mutable fields**: title, description (updated by this feature)
- **3 immutable fields**: id, created, status (preserved by this feature)
- **Validation reuse**: Leverages existing Task.__post_init__ validation
- **Storage reuse**: Uses existing in-memory _tasks dictionary
- **No schema changes**: Task dataclass structure unchanged
