# CLI Interface Contract: Add Task

**Feature**: Add Task
**Date**: 2025-12-31
**Version**: 1.0
**Interface Type**: Command-line interface (argparse-based)

## Overview

This contract defines the command-line interface for the Add Task feature. It specifies the exact command syntax, arguments, options, outputs, and error conditions that users and automated tests can rely on.

## Command Syntax

### Basic Usage

```bash
python src/main.py add <title> [options]
```

### With Description

```bash
python src/main.py add <title> --description <description>
python src/main.py add <title> -d <description>
```

### Examples

```bash
# Add task with title only
python src/main.py add "Buy groceries"

# Add task with title and description
python src/main.py add "Prepare presentation" --description "Include Q4 metrics and competitor analysis"

# Using short option
python src/main.py add "Call dentist" -d "Schedule checkup for next month"

# Title with special characters
python src/main.py add "Review PR #123" -d "Check unit tests and documentation"
```

---

## Arguments & Options

### Positional Arguments

| Argument | Type | Required | Description | Example |
|----------|------|----------|-------------|---------|
| `title` | String | Yes | Task title (1-500 characters, non-empty) | `"Buy groceries"` |

**Validation**:
- MUST be provided (argparse enforces this)
- MUST NOT be empty or whitespace-only after trimming
- MUST NOT exceed 500 characters
- Quotes required if title contains spaces or special shell characters

---

### Optional Flags

| Flag | Short | Type | Default | Description | Example |
|------|-------|------|---------|-------------|---------|
| `--description` | `-d` | String | `""` | Task description (0-5000 characters) | `--description "Details here"` |

**Validation**:
- MAY be omitted (defaults to empty string)
- MUST NOT exceed 5000 characters
- Quotes required if description contains spaces

---

### Global Options (Inherited)

| Flag | Short | Description |
|------|-------|-------------|
| `--help` | `-h` | Display help message for add command |
| `--version` | `-v` | Display application version |

---

## Output Specification

### Success Output (Exit Code 0)

**Format**: Single-line confirmation message to stdout

```
Task created successfully!
ID: <task-uuid>
Title: <title>
Description: <description or "(none)">
Status: Incomplete
Created: <ISO 8601 timestamp>
```

**Example**:
```
Task created successfully!
ID: 6ba7b810-9dad-11d1-80b4-00c04fd430c8
Title: Buy groceries
Description: (none)
Status: Incomplete
Created: 2025-12-31T10:30:45
```

**Contract Guarantees**:
- First line always starts with "Task created successfully!"
- ID line always present and displays the generated UUID
- Title line displays the exact title as stored (trimmed)
- Description line shows "(none)" if empty, otherwise the full description
- Status line always shows "Incomplete" for newly created tasks
- Created line shows ISO 8601 formatted timestamp
- Exit code is 0

---

### Error Output (Exit Code 1)

**Format**: Error message to stderr, usage hint to stderr

**Empty Title Error**:
```
Error: Title cannot be empty
Usage: python src/main.py add <title> [--description <description>]
```

**Title Too Long Error**:
```
Error: Title cannot exceed 500 characters (provided: <length>)
Usage: python src/main.py add <title> [--description <description>]
```

**Description Too Long Error**:
```
Error: Description cannot exceed 5000 characters (provided: <length>)
Usage: python src/main.py add <title> [--description <description>]
```

**Missing Title Error** (argparse built-in):
```
usage: main.py add [-h] [-d DESCRIPTION] title
main.py add: error: the following arguments are required: title
```

**Contract Guarantees**:
- Error message sent to stderr (not stdout)
- Exit code is 1
- Error message starts with "Error: "
- Includes actionable information (e.g., character count)

---

### Help Output (Exit Code 0)

**Invocation**: `python src/main.py add --help` or `python src/main.py add -h`

**Format**:
```
usage: main.py add [-h] [-d DESCRIPTION] title

Add a new task to your todo list

positional arguments:
  title                 Task title (required, 1-500 characters)

optional arguments:
  -h, --help            show this help message and exit
  -d DESCRIPTION, --description DESCRIPTION
                        Task description (optional, max 5000 characters)

examples:
  python src/main.py add "Buy groceries"
  python src/main.py add "Prepare presentation" -d "Include Q4 metrics"
```

**Contract Guarantees**:
- Auto-generated by argparse
- Exit code is 0
- Displays usage, arguments, options, and examples

---

## Exit Codes

| Exit Code | Meaning | When Triggered |
|-----------|---------|----------------|
| 0 | Success | Task created successfully |
| 0 | Help displayed | User ran --help flag |
| 1 | Validation error | Empty title, title too long, description too long |
| 1 | Missing argument | User didn't provide required title |
| 2 | Internal error | Unexpected exception (e.g., ID collision, storage failure) |

---

## Integration with Service Layer

### Call Sequence

```
CLI (add_task.py)
    â†“
1. Parse arguments (argparse)
    â†’ args.title: str
    â†’ args.description: str (default="")
    â†“
2. Call task_service.create_task(title, description)
    â†’ Validates title, description
    â†’ Generates ID
    â†’ Creates Task object
    â†’ Stores in memory
    â†’ Returns Task object or raises ValueError
    â†“
3. Handle result
    â†’ Success: Format and print confirmation â†’ Exit 0
    â†’ ValueError: Print error to stderr â†’ Exit 1
    â†’ Unexpected exception: Print error to stderr â†’ Exit 2
```

**Service Function Signature**:
```python
def create_task(title: str, description: str = "") -> Task:
    """
    Create a new task with the given title and optional description.

    Args:
        title: Task title (required, will be trimmed, must be non-empty)
        description: Task description (optional, defaults to empty string)

    Returns:
        Task: The created task object

    Raises:
        ValueError: If title is empty/whitespace-only, title > 500 chars,
                    or description > 5000 chars
    """
```

---

## Edge Cases Handling

### Special Characters

**Input**: `python src/main.py add "Review PR #123" -d "Check \"unit tests\""`

**Expected Behavior**:
- Shell handles quote escaping (user must escape quotes)
- Python receives: `title="Review PR #123"`, `description='Check "unit tests"'`
- Stored exactly as received (FR-009)
- Output displays quotes as-is

**Contract Guarantee**: CLI does not modify or sanitize special characters beyond shell processing

---

### Whitespace Handling

**Input**: `python src/main.py add "  Buy groceries  "`

**Expected Behavior**:
- Title trimmed: `"Buy groceries"` (leading/trailing spaces removed)
- Internal spaces preserved: `"Buy  groceries"` (double space kept)
- Stored as trimmed version
- Output displays trimmed version

**Contract Guarantee**: Leading/trailing whitespace trimmed, internal whitespace preserved

---

### Empty Description

**Input**: `python src/main.py add "Buy milk"`

**Expected Behavior**:
- Description defaults to empty string `""`
- Task created successfully
- Output shows `Description: (none)`

**Contract Guarantee**: Description is optional; omitting it is valid

---

### Unicode Characters

**Input**: `python src/main.py add "CafÃ© â˜•" -d "Get coffee from the cafÃ© â˜•ðŸ‡«ðŸ‡·"`

**Expected Behavior**:
- Unicode characters accepted (Python 3.13+ native support)
- Stored exactly as entered
- Output displays Unicode correctly (if terminal supports it)

**Contract Guarantee**: Full Unicode support for all text fields

---

## Testing Contract

### Contract Tests (Automated)

These tests verify the CLI contract is honored:

1. **Success Path**:
   ```bash
   # Test: Title only
   python src/main.py add "Test task"
   # Assert: Exit code 0, output contains "Task created successfully!", ID present
   ```

2. **Error Path - Empty Title**:
   ```bash
   # Test: Empty title after trimming
   python src/main.py add "   "
   # Assert: Exit code 1, stderr contains "Error: Title cannot be empty"
   ```

3. **Error Path - Title Too Long**:
   ```bash
   # Test: 501 character title
   python src/main.py add "<501-char-string>"
   # Assert: Exit code 1, stderr contains "Error: Title cannot exceed 500 characters"
   ```

4. **Success Path - Title + Description**:
   ```bash
   # Test: Both fields provided
   python src/main.py add "Task" --description "Details"
   # Assert: Exit code 0, output contains both title and description
   ```

5. **Help Display**:
   ```bash
   # Test: Help flag
   python src/main.py add --help
   # Assert: Exit code 0, output contains usage, arguments, examples
   ```

---

## Backward Compatibility

**Phase I Scope**: First implementation, no backward compatibility concerns

**Future Versions**:
- Adding new optional flags: COMPATIBLE (old commands still work)
- Changing required arguments: BREAKING (requires version bump)
- Changing output format: BREAKING (breaks parsing scripts)

**Versioning Strategy**: Follow semantic versioning (MAJOR.MINOR.PATCH)
- Breaking changes: MAJOR version bump (e.g., 1.0.0 â†’ 2.0.0)
- New features (compatible): MINOR version bump (e.g., 1.0.0 â†’ 1.1.0)
- Bug fixes: PATCH version bump (e.g., 1.0.0 â†’ 1.0.1)

---

## Acceptance Criteria Mapping

This contract satisfies:

- **FR-001**: Accepts task title (positional argument)
- **FR-005**: Accepts optional description (--description flag)
- **FR-006**: Validates non-empty title (error message on empty)
- **FR-007**: Provides confirmation with task ID (success output format)
- **FR-008**: Rejects invalid input with clear error (error output format)
- **FR-009**: Preserves exact text (except title trimming)

---

## Implementation Checklist

- [ ] argparse configuration with positional `title` and optional `-d/--description`
- [ ] Help message with usage examples
- [ ] Success output formatter (stdout, exit 0)
- [ ] Error output formatter (stderr, exit 1)
- [ ] Integration with `task_service.create_task()`
- [ ] Exception handling (ValueError â†’ exit 1, others â†’ exit 2)
- [ ] Contract tests for all specified behaviors
- [ ] Manual testing with special characters, Unicode, edge cases
